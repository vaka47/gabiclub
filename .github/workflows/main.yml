name: 🚀 Deploy to REG.RU server

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: 📥 Checkout code
        uses: actions/checkout@v3

      - name: 🛠️ Setup SSH key
        run: |
          mkdir -p ~/.ssh
          echo "${{ secrets.REG_RU_DEPLOY_KEY }}" > ~/.ssh/id_deploy
          chmod 600 ~/.ssh/id_deploy

      - name: 🕵️ Show SSH key fingerprint
        run: |
          echo "🔐 SSH key fingerprint:"
          ssh-keygen -lf ~/.ssh/id_deploy || echo "❌ Не удалось прочитать ключ"

      - name: 🔐 Add REG.RU server to known_hosts
        run: |
          ssh-keyscan server295.hosting.reg.ru >> ~/.ssh/known_hosts

      - name: 🚀 Deploy via SSH
        run: |
          ssh -i ~/.ssh/id_deploy u3187320@server295.hosting.reg.ru 'ls -la ~/gabiclub'
