name: ðŸš€ Deploy to REG.RU server

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v3

      - name: ðŸ› ï¸ Setup SSH key
        run: |
          mkdir -p ~/.ssh
          echo "${{ secrets.REG_RU_DEPLOY_KEY }}" > ~/.ssh/id_deploy
          chmod 600 ~/.ssh/id_deploy

      - name: ðŸ•µï¸ Show SSH key fingerprint
        run: |
          echo "ðŸ” SSH key fingerprint:"
          ssh-keygen -lf ~/.ssh/id_deploy || echo "âŒ ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¿Ñ€Ð¾Ñ‡Ð¸Ñ‚Ð°Ñ‚ÑŒ ÐºÐ»ÑŽÑ‡"

      - name: ðŸ” Add REG.RU server to known_hosts
        run: |
          ssh-keyscan server295.hosting.reg.ru >> ~/.ssh/known_hosts

      - name: ðŸš€ Deploy via SSH
        run: |
          ssh -i ~/.ssh/id_deploy u3187320@server295.hosting.reg.ru 'ls -la ~/gabiclub'
